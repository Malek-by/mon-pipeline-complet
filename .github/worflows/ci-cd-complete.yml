name: ğŸš€ CI/CD Complet

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  # PHASE 1: INTÃ‰GRATION CONTINUE
  continuous-integration:
    name: ğŸ§ª CI - Tests et Validation
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ TÃ©lÃ©charger le code
      uses: actions/checkout@v4
      
    - name: ğŸ” Validation complÃ¨te
      run: |
        echo "=== DÃ‰BUT DES VALIDATIONS CI ==="
        
        # Validation des fichiers
        echo "1. VÃ©rification des fichiers..."
        [ -f "index.html" ] || exit 1
        echo "   âœ… index.html prÃ©sent"
        
        # Validation HTML
        echo "2. Validation HTML..."
        grep -q "<!DOCTYPE html>" index.html || exit 1
        grep -q "</html>" index.html || exit 1
        echo "   âœ… HTML valide"
        
        # MÃ©triques de qualitÃ©
        echo "3. MÃ©triques de qualitÃ©..."
        LINES=$(wc -l < index.html)
        echo "   ğŸ“Š Lignes de code: $LINES"
        
        echo "=== VALIDATION CI RÃ‰USSIE ==="
        
    - name: ğŸ“ˆ Rapport CI
      run: |
        echo "ğŸ“‹ RAPPORT CI - ${{ github.sha }}"
        echo "âœ… Tous les tests passent"
        echo "âœ… Code validÃ©"
        echo "âœ… PrÃªt pour le dÃ©ploiement"

  # PHASE 2: DÃ‰PLOIEMENT CONTINU
  continuous-deployment:
    name: ğŸŒ CD - DÃ©ploiement Production
    runs-on: ubuntu-latest
    needs: continuous-integration  # DÃ©pend de la phase CI
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    
    steps:
    - name: ğŸ“¥ TÃ©lÃ©charger le code
      uses: actions/checkout@v4
      
    - name: ğŸš€ DÃ©ployer l'application
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./
        
    - name: ğŸ‰ Confirmation
      run: |
        echo "ğŸŠ DÃ‰PLOIEMENT AUTOMATIQUE RÃ‰USSI !"
        echo ""
        echo "ğŸŒ URL: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/"
        echo "ğŸ• Heure: $(date)"
        echo "ğŸ”— Commit: ${{ github.sha }}"